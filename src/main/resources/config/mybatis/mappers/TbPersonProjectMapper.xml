<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silita.biaodaa.dao.TbPersonProjectMapper" >
  <resultMap id="BaseResultMap" type="com.silita.biaodaa.model.TbPersonProject" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="pkid" property="pkid" jdbcType="INTEGER" />
    <result column="innerid" property="innerid" jdbcType="VARCHAR" />
    <result column="pid" property="pid" jdbcType="INTEGER" />
    <result column="com_name" property="comName" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="category" property="category" jdbcType="VARCHAR" />
    <result column="cert_no" property="certNo" jdbcType="VARCHAR" />
    <result column="safe_no" property="safeNo" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="role" property="role" jdbcType="VARCHAR" />
    <result column="created" property="created" jdbcType="TIMESTAMP" />
    <result column="updated" property="updated" jdbcType="TIMESTAMP" />
    <result column="id_card" property="idCard" jdbcType="VARCHAR"/>
  </resultMap>

  <select id="queryPersonProject" resultMap="BaseResultMap" parameterType="java.util.Map">
    SELECT
      t.com_name
      ,t.`cert_no`
      ,t.`safe_no`
      ,t.`status`
      ,t.`role`
      ,t.`innerid`
      ,t.`name`
    FROM tb_person_project t
    LEFT JOIN tb_project_build t1 ON t.`pid` = t1.`pkid`
    WHERE 1=1
    <if test="type != null and type != ''">
      and t.`type` = #{type}
    </if>
    AND t1.`pro_id` = #{proId}
    AND t1.`pkid` = #{pkid}
    <if test="role != null and role != ''">
      AND (t.`role` = #{role} OR t.`role` = #{roleOne})
    </if>
    <if test="company != null and company != ''">
      AND t1.`b_org` = #{company}
    </if>
  </select>

  <select id="queryPersonByInnerId" resultType="java.util.Map" parameterType="java.lang.String">
      SELECT
        t1.`id_card` as idCard
        ,t.`seal_no` AS sealNo
      FROM tb_person_qualification t
      LEFT JOIN tb_person t1 ON t.`per_id` = t1.`pkid`
      WHERE t.`innerid` = #{innerId}
      GROUP BY t.`innerid`
  </select>

  <select id="queryInnerIdByPkid" parameterType="java.util.List" resultMap="BaseResultMap">
    SELECT
      t.*
     FROM tb_person_project t
     WHERE t.`pid` IN
     <foreach collection="list" item="list" index="index" separator="," open="(" close=")">
       #{list.pkid}
     </foreach>
      and t.type = 'design'
  </select>

  <select id="queryPersonProjectByPid" resultMap="BaseResultMap" parameterType="java.util.Map">
    select
      t.*
    from tb_person_project t
    where t.pid = #{pid}
    and (t.role = #{role} or t.role = #{roleOther})
    and t.type = 'build'
  </select>
</mapper>