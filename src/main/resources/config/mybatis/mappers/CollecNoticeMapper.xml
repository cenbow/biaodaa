<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silita.biaodaa.dao.CollecNoticeMapper">

    <select id="getCollecNoticeByUserIdAndNoticeId" parameterType="com.silita.biaodaa.model.CollecNotice"
            resultType="com.silita.biaodaa.model.CollecNotice">
      SELECT * FROM mishu_write.collec_notice WHERE userId = #{userid} AND noticeId = #{noticeid}
    </select>

    <insert id="insertCollecNotice" parameterType="com.silita.biaodaa.model.CollecNotice">
      INSERT INTO mishu_write.collec_notice(userId, `type`, noticeId, noticeRelationNum, collecTime, readOrReaded)
      VALUES(#{userid}, #{type}, #{noticeid}, 0, NOW(), 0)
    </insert>

    <delete id="deleteCollecNoticeByUserIdAndNoticeId" parameterType="com.silita.biaodaa.model.CollecNotice">
        DELETE FROM mishu_write.collec_notice WHERE `userId` = #{userid} AND `noticeId` = #{noticeid}
    </delete>

    <select id="listZhaoBiaoCollecNoticeByUserId" parameterType="com.silita.biaodaa.model.CollecNotice"
            resultType="Map">
        SELECT n.userId, n.type, s.id, s.title, s.openDate, d.projDq, d.projXs, d.projType, d.pbMode, temp.certificate
        FROM mishu_write.collec_notice n
        LEFT JOIN mishu.snatchurl s ON s.id = n.noticeId
        LEFT JOIN mishu.zhaobiao_detail d ON s.id = d.snatchUrlId
        LEFT JOIN (SELECT GROUP_CONCAT(c.certificate) AS certificate, c.contId as contId
          FROM mishu.snatch_url_cert c
          LEFT JOIN mishu_write.collec_notice n1 ON n1.noticeId = c.contId
          WHERE n1.userId = #{userid} AND n1.type = #{type}
          GROUP BY n1.noticeId) temp ON temp.contId = d.snatchUrlId
        WHERE n.userId = #{userid} AND n.type = #{type}
    </select>

    <select id="listZhongBiaoCollecNoticeByUserId" parameterType="com.silita.biaodaa.model.CollecNotice"
            resultType="Map">
        SELECT n.userId, s.id, s.title, s.openDate, d.projSum, d.projType, d.oneName, d.projType, d.pbMode, d.projDq, d.projXs
        FROM  mishu_write.collec_notice n
        LEFT JOIN mishu.zhongbiao_detail d ON n.noticeId = d.snatchUrlId
        LEFT JOIN mishu.snatchurl s ON d.snatchUrlId = s.id
        WHERE n.userId = #{userid} AND n.type = #{type}
    </select>
</mapper>